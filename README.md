# Core-Gene-Phylogeny-Pipeline

---

This repository contains scripts to generate a **core gene phylogeny** from a set of bacterial genomes in FASTA format. The pipeline performs genome annotation, pangenome analysis, core gene alignment, phylogeny inference, removes poorly aligned regions or spurious sequences and recombination filtering.

## Overview

The pipeline consists of the following steps:

1. **Annotation**: Annotate genomes using [Bakta](https://github.com/oschwengers/bakta).
2. **Pangenome Analysis**: Identify core genes using [Panaroo](https://github.com/gtonkinhill/panaroo).
3. **Initial Phylogeny**: Generate an initial maximum likelihood phylogeny [IQ-TREE](https://github.com/iqtree/iqtree3).
4. **Alignment Trimming**: Trim the core gene alignment with [Trimal](http://trimal.cgenomics.org/).
5. **Phylogeny Inference**: Build a maximum likelihood tree with [IQ-TREE](http://www.iqtree.org/).
6. **Recombination Filtering**: Filter for recombination and generate a final phylogeny using [ClonalFrameML](https://github.com/xavierdidelot/ClonalFrameML).

---

## Requirements

- Python 3
- [Bakta](https://github.com/oschwengers/bakta)
- [Panaroo](https://github.com/gtonkinhill/panaroo)
- [Trimal](http://trimal.cgenomics.org/)
- [IQ-TREE](http://www.iqtree.org/)
- [ClonalFrameML](https://github.com/xavierdidelot/ClonalFrameML)

Install each tool according to its official documentation. If you use Conda, all tools except Bakta can be installed and run within a single environment.
---

## Usage

### 1. Genome Annotation with Bakta

**Script:** `annotate_with_bakta.py`

**Usage:**
```bash
python annotate_with_bakta.py <fasta_directory> <num_cores> <bakta_db_path>
```
- `<fasta_directory>`: Directory containing your `.fasta` or `.fa` files.
- `<num_cores>`: Number of CPU cores to use for Bakta.
- `<bakta_db_path>`: Path to your Bakta database.

**Example:**
```bash
python annotate_with_bakta.py ./path/to/genome/fasta/files 8 /path/to/bakta_db
```

This will annotate each genome and output results to a `bakta_out/` directory.

---

### 2. Core Gene Phylogeny Pipeline

**Script:** `core_gene_phylogeny.py`

**Usage:**
```bash
python core_gene_phylogeny.py <num_cores>
```
- `<num_cores>`: Number of CPU cores to use for Panaroo and IQ-TREE.
- GFF3 files should be located in individual sample subdirectories within the bakta_out directory, following the structure:
bakta_out/<sample_name>/<sample_name>.gff3

**Example:**
```bash
python core_gene_phylogeny.py 8
```

This script will:
- Collect GFF3 files from `bakta_out/`
- Run Panaroo to generate a core gene alignment
- Trim the alignment with Trimal
- Build a maximum likelihood tree with IQ-TREE (100 bootstraps)
- Filter for recombination with ClonalFrameML

The final phylogeny will be output as:
```
results/clonalframeml_out.labelled_tree.newick
```

---

## Output

- **Annotated genomes:** `bakta_out/`
- **Panaroo results:** `results/`
- **Trimmed alignment:** `results/core_gene_alignment.trimmed.aln`
- **IQ-TREE tree:** `results/core_gene_alignment.trimmed.aln.treefile`
- **Final phylogeny:** `results/clonalframeml_out.labelled_tree.newick`

---

## Notes

- Ensure all required tools are installed and available in your `$PATH`.
- GFF3 files are generated by Bakta and are required for Panaroo.
- Adjust parameters (e.g., core threshold, alignment method) in the scripts as needed for your dataset.

---

## Citation

If you use this pipeline, please cite the respective tools:

- Bakta: Schwengers et al., 2021
- Panaroo: Tonkin-Hill et al., 2020
- Trimal: Capella-GutiÃ©rrez et al., 2009
- IQ-TREE: Nguyen et al., 2015
- ClonalFrameML: Didelot & Wilson, 2015

---

## License

MIT License

---

**Happy phylogenomics!** ðŸ§¬ðŸŒ³

---
